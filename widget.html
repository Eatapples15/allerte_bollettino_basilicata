<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generatore Widget Allerta</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f6f8; color: #333; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { max-width: 900px; width: 100%; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; text-align: center; margin-bottom: 10px; }
        .step-box { background: #eef2f5; padding: 20px; border-radius: 8px; margin-bottom: 30px; border-left: 5px solid #3498db; }
        select { width: 100%; padding: 12px; font-size: 16px; border: 1px solid #ccc; border-radius: 4px; background: white; cursor: pointer; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
        .preview-area { display: flex; flex-direction: column; align-items: center; }
        textarea { width: 100%; height: 380px; padding: 10px; font-family: monospace; font-size: 12px; border: 1px solid #ccc; border-radius: 4px; background: #2c3e50; color: #ecf0f1; resize: none; }
        .btn-copy { background-color: #3498db; color: white; border: none; padding: 12px; font-size: 16px; border-radius: 4px; cursor: pointer; width: 100%; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Portale Integrazione Widget</h1>
        <p style="text-align:center; color:#777;">Seleziona il comune per ottenere il codice HTML.</p>

        <div class="step-box">
            <label>1. Seleziona il Comune:</label>
            <select id="comuneSelect" onchange="generaCodice()">
                <option value="" disabled selected>-- Cerca il tuo Comune --</option>
            </select>
        </div>

        <div class="grid" id="outputArea" style="opacity: 0.5; pointer-events: none;">
            <div class="preview-area">
                <div style="font-weight:bold; color:#2ecc71; margin-bottom:10px;">Anteprima Live</div>
                <div id="widget-container"></div>
            </div>
            <div>
                <div style="font-weight:bold; color:#3498db; margin-bottom:10px;">Codice da Copiare</div>
                <textarea id="codeOutput" readonly onclick="this.select()">...</textarea>
                <button class="btn-copy" onclick="copiaCodice()">ðŸ“‹ Copia Codice</button>
            </div>
        </div>
    </div>

    <script>
        // ðŸ”´ðŸ”´ðŸ”´ MODIFICA QUI: URL DEL TUO GITHUB ðŸ”´ðŸ”´ðŸ”´
        const BASE_GITHUB_URL = "https://eatapples15.github.io/allerte_bollettino_basilicata"; 
        const LOGO_URL = "logo.png"; // Se il logo Ã¨ sul tuo FTP, va bene relativo, altrimenti metti URL assoluto

        const municipalityMap = {
            "Abriola": "BASI B", "Accettura": "BASI B", "Acerenza": "BASI B", "Albano di Lucania": "BASI B", "Aliano": "BASI C", "Anzi": "BASI B", "Armento": "BASI C", "Atella": "BASI A1", "Avigliano": "BASI B", 
            "Balvano": "BASI A2", "Banzi": "BASI B", "Baragiano": "BASI A2", "Barile": "BASI A1", "Bella": "BASI A2", "Bernalda": "BASI E2", "Brienza": "BASI A2", "Brindisi Montagna": "BASI B", "Calciano": "BASI B", "Calvello": "BASI B", "Calvera": "BASI C", "Campomaggiore": "BASI B", "Cancellara": "BASI B", "Carbone": "BASI C", "Castelgrande": "BASI A2", "Castelluccio Inferiore": "BASI D", "Castelluccio Superiore": "BASI D", "Castelmezzano": "BASI B", "Castelsaraceno": "BASI D", "Castronuovo di Sant' Andrea": "BASI C", "Cersosimo": "BASI C", "Chiaromonte": "BASI C", "Cirigliano": "BASI C", "Colobraro": "BASI C", "Corleto Perticara": "BASI C", "Craco": "BASI E1", "Episcopia": "BASI C", "Fardella": "BASI C", "Ferrandina": "BASI B", "Filiano": "BASI A1", "Forenza": "BASI A1", "Francavilla in Sinni": "BASI C", "Gallicchio": "BASI C", "Garaguso": "BASI B", "Genzano di Lucania": "BASI B", "Ginestra": "BASI A1", "Gorgoglione": "BASI C", "Grassano": "BASI B", "Grottole": "BASI B", "Grumento Nova": "BASI C", "Guardia Perticara": "BASI C", "Irsina": "BASI B", "Lagonegro": "BASI D", "Latronico": "BASI D", "Laurenzana": "BASI B", "Lauria": "BASI D", "Lavello": "BASI A1", "Maratea": "BASI D", "Marsico Nuovo": "BASI C", "Marsicovetere": "BASI C", "Maschito": "BASI A1", "Matera": "BASI B", "Melfi": "BASI A1", "Miglionico": "BASI B", "Missanello": "BASI C", "Moliterno": "BASI C", "Montalbano Jonico": "BASI E1", "Montemilone": "BASI A1", "Montemurro": "BASI C", "Montescaglioso": "BASI E2", "Muro Lucano": "BASI A2", "Nemoli": "BASI D", "Noepoli": "BASI C", "Nova Siri": "BASI E1", "Oliveto Lucano": "BASI B", "Oppido Lucano": "BASI B", "Palazzo San Gervasio": "BASI A1", "Paterno": "BASI C", "Pescopagano": "BASI A1", "Picerno": "BASI A2", "Pietragalla": "BASI B", "Pietrapertosa": "BASI B", "Pignola": "BASI B", "Pisticci": "BASI E2", "Policoro": "BASI E1", "Pomarico": "BASI B", "Potenza": "BASI B", "Rapolla": "BASI A1", "Rapone": "BASI A1", "Rionero in Vulture": "BASI A1", "Ripacandida": "BASI A1", "Rivello": "BASI D", "Roccanova": "BASI C", "Rotonda": "BASI D", "Rotondella": "BASI E1", "Ruoti": "BASI A2", "Ruvo del Monte": "BASI A1", "Salandra": "BASI B", "San Chirico Nuovo": "BASI B", "San Chirico Raparo": "BASI C", "San Costantino A.": "BASI C", "San Costantino Albanese": "BASI C", "S. Costantino Albanese": "BASI C", "San Fele": "BASI A1", "San Giorgio Lucano": "BASI C", "San Martino d'Agri": "BASI C", "San Mauro Forte": "BASI B", "San Paolo Albanese": "BASI C", "San Severino Lucano": "BASI C", "Sant' Angelo Le Fratte": "BASI A2", "Sant' Arcangelo": "BASI C", "Sarconi": "BASI C", "Sasso di Castalda": "BASI A2", "Satriano di Lucania": "BASI A2", "Savoia di Lucania": "BASI A2", "Scanzano Jonico": "BASI E1", "Senise": "BASI C", "Spinoso": "BASI C", "Stigliano": "BASI C", "Teana": "BASI C", "Terranova di Pollino": "BASI C", "Tito": "BASI A2", "Tolve": "BASI B", "Tramutola": "BASI C", "Trecchina": "BASI D", "Tricarico": "BASI B", "Trivigno": "BASI B", "Tursi": "BASI C", "Vaglio Basilicata": "BASI B", "Valsinni": "BASI C", "Venosa": "BASI A1", "Vietri di Potenza": "BASI A2", "Viggianello": "BASI D", "Viggiano": "BASI C"
        };

        const select = document.getElementById('comuneSelect');
        const sortedComuni = Object.keys(municipalityMap).sort();
        sortedComuni.forEach(c => {
            const opt = document.createElement('option');
            opt.value = c; opt.innerText = c;
            select.appendChild(opt);
        });

        function generaCodice() {
            const comune = select.value;
            if (!comune) return;
            const zona = municipalityMap[comune];
            const jsonUrl = BASE_GITHUB_URL + "/dati_bollettino.json";

            // NOTA: Se il logo Ã¨ sul tuo FTP e il widget Ã¨ embeddato altrove, serve URL assoluto per il logo!
            // Assicurati che LOGO_URL sia accessibile pubblicamente.
            
            const template = `<div id="w-pc" style="font-family:sans-serif;border:1px solid #ddd;border-radius:10px;width:280px;padding:20px;text-align:center;background:#fff;box-shadow:0 2px 10px rgba(0,0,0,0.1);">
  <div style="font-size:10px;color:#888;text-transform:uppercase;">Protezione Civile Basilicata</div>
  <div style="font-size:16px;font-weight:bold;margin:10px 0;">COMUNE DI ${comune.toUpperCase()}</div>
  <div id="pc-sem" style="width:60px;height:60px;border-radius:50%;background:#eee;margin:0 auto;"></div>
  <div id="pc-txt" style="font-size:18px;font-weight:bold;margin-top:10px;color:#ccc;">...</div>
  <div id="pc-date" style="font-size:10px;color:#aaa;margin-top:10px;"></div>
</div>
<script>
(function(){
  fetch("${jsonUrl}?t="+Date.now()).then(r=>r.json()).then(d=>{
    const z="${zona}",c={"green":"#2ecc71","yellow":"#f1c40f","orange":"#e67e22","red":"#e74c3c"},
    l={"green":"ORDINARIA","yellow":"ATTENZIONE","orange":"PREALLARME","red":"ALLARME"};
    let k="green";
    for(let[x,y]of Object.entries(d.zone))if(z.toUpperCase().includes(x.toUpperCase()))k=y;
    document.getElementById("pc-sem").style.background=c[k];
    document.getElementById("pc-sem").style.boxShadow="0 0 15px "+c[k];
    document.getElementById("pc-txt").innerText=l[k];
    document.getElementById("pc-txt").style.color=c[k]=="yellow"?"#d4ac0d":c[k];
    document.getElementById("pc-date").innerText="ValiditÃ : "+d.validita_inizio;
  });
})();
<\/script>`;

            document.getElementById('outputArea').style.opacity = "1";
            document.getElementById('outputArea').style.pointerEvents = "auto";
            document.getElementById('codeOutput').value = template;

            const box = document.getElementById('widget-container');
            box.innerHTML = "";
            const iframe = document.createElement('iframe');
            iframe.style.border = "none"; iframe.style.width = "300px"; iframe.style.height = "400px";
            box.appendChild(iframe);
            iframe.contentWindow.document.write(template);
        }

        function copiaCodice() {
            const t = document.getElementById("codeOutput"); t.select(); navigator.clipboard.writeText(t.value);
        }
    </script>
</body>
</html>
