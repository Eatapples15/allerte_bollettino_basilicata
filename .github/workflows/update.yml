- name: Commit e Push dei cambiamenti
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          # 1. Scarichiamo eventuali aggiornamenti remoti prima di toccare i file
          git pull origin main --rebase

          # 2. Eseguiamo lo script qui (se preferisci farlo dentro lo step di commit per sicurezza)
          # In alternativa, lasciamo lo step precedente ma usiamo git add prima del pull.
          # La via più semplice è aggiungere i file prima del pull:
          
          git add dati_bollettino.json last_notified.txt || true
          
          # Se il pull fallisce ancora, usiamo lo stash temporaneo
          git stash || true
          git pull origin main --rebase
          git stash pop || true
          
          git add dati_bollettino.json last_notified.txt
          
          if git diff --staged --quiet; then
            echo "Nessuna modifica."
          else
            git commit -m "Aggiornamento dati bollettino $(date +'%d/%m/%Y %H:%M')"
            git push origin main
          fi
